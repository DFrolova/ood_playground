from ...assets.core import *
from ...assets.utils.no_pred import *
from ...assets.dataset.cc359 import *
from ...assets.batch_iter.patch_sampling_3d import *
from ...assets.architecture.unet3d import *
from ...assets.cross_val.cv_cc359 import *
from ...assets.metric.metrics_3d import *
from ...assets.batch_iter.crop_sampling import *
from ...assets.ood_methods.mc_dropout import *
from ...assets.ood_data.predict_new_data import *
from ...assets.ood_data.crop import *

from ood.metric.metric import evaluate_individual_metrics_probably_with_ids_no_pred_mc_dropout_with_crops


saved_model_path = os.path.join(ENSEMBLE_MODELS_PATH_CC359, f'mc_dropout/experiment_0/model.pth')

evaluate_individual_metrics = partial(
    evaluate_individual_metrics_probably_with_ids_no_pred_mc_dropout_with_crops,
    load_y=load_y,
    load_x=load_x,
    predict=predict,
    predict_logit=predict_logit,
    predict_with_dropout=partial(predictions_mc_dropout, N=N),
    test_ids=test_ids,
    spatial_boxes_path=spatial_boxes_path,
    n_repeats=n_repeats,
    agg_function=partial(get_inconsistency_metrics, top_n_voxels=top_n_voxels),
    segm_functions=final_metrics,
)