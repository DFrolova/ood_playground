from ...assets.core import *
from ...assets.utils.no_pred import *
from ...assets.dataset.cc359 import *
from ...assets.batch_iter.patch_sampling_3d import *
from ...assets.architecture.unet3d import *
from ...assets.cross_val.cv_cc359 import *
from ...assets.metric.metrics_3d import *


from dpipe.torch.functional import weighted_cross_entropy_with_logits
from dpipe.train import Switch
from ood.loss import find_lr_schedule_fn


criterion = weighted_cross_entropy_with_logits

train_ids = layout.get_ids('train')[:5]

n_experiments = 1
batches_per_epoch = 1
n_epochs = 60

lr_min = 1e-4
lr_opt = 10
lr = Switch(initial=lr_min,
            epoch_to_value={i: find_lr_schedule_fn(i, lr_max=lr_opt, lr_min=lr_min, n_epochs=n_epochs)
                            for i in range(n_epochs)})

validate_step = None