from ....assets.ood_methods.image_statistics import *

import numpy as np
from sklearn.model_selection import train_test_split

from ood.dataset.svd_benchmark.liver import LiverDataset
from ood.dataset.utils import ZoomImage, ScaleUniversal
from ood.paths import LIVER_DATASET_DATA_PATH


voxel_spacing = (1., 1., 1.5)
dataset = LiverDataset(LIVER_DATASET_DATA_PATH) >> ZoomImage(new_spacing=voxel_spacing) #>> ScaleUniversal()
load_x = dataset.image

train_predictions_path = '.'

id_ids = [uid for uid in dataset.ids if dataset.protocol_name(uid) != 'T2SPIR' and dataset.modality(uid) == 'MRI']
ood_ids = [uid for uid in dataset.ids if dataset.protocol_name(uid) == 'T2SPIR' and dataset.modality(uid) == 'MRI']

random_state_split = np.random.RandomState(0xBadCafe)
train_id_ids, test_id_ids = train_test_split(id_ids, test_size=0.3, random_state=random_state_split, shuffle=True,
                                             stratify=[dataset.protocol_name(uid) for uid in id_ids])

split = [[train_id_ids,
          [],
          test_id_ids + ood_ids]]
