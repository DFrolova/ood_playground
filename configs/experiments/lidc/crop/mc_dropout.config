from ....assets.core_luna import *
from ....assets.utils.no_pred import *
from ....assets.dataset.luna import *
from ....assets.batch_iter.patch_sampling_3d_axial import *
from ....assets.architecture.unet_lidc import *
from ....assets.cross_val.lidc import *
from ....assets.metric.metrics_3d import *
from ....assets.ood_methods.mc_dropout_lidc import *
from ....assets.ood_data.crop_lidc import *

from ood.metric.metric import evaluate_individual_metrics_probably_with_ids_no_pred_mc_dropout_with_crops


saved_model_path = os.path.join(ENSEMBLE_MODELS_PATH_LIDC, f'mc_dropout/experiment_0/model.pth')  # todo remove

evaluate_individual_metrics = partial(
    evaluate_individual_metrics_probably_with_ids_no_pred_mc_dropout_with_crops,
    load_y=load_y,
    load_x=load_x,
    predict=predict,
    predict_logit=predict_logit,
    predict_with_dropout=partial(predictions_mc_dropout, N=N),
    test_ids=test_ids,
    spatial_boxes_path=spatial_boxes_path,
    n_repeats=n_repeats,
    agg_function=partial(get_inconsistency_metrics, top_n_voxels=top_n_voxels),
    segm_functions=final_metrics,
)

predict_to_dir = skip_predict
