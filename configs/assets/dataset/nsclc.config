import numpy as np
from connectome import Chain, Filter, Apply
from amid.nsclc import NSCLC

from dpipe.io import load
from ood.dataset.utils import Zoom
from ood.dataset.cancer500 import CanonicalCTOrientation
from ood.paths import NSCLC_DATA_PATH
from ood.utils import get_lib_root_path


filtered_ids = load(get_lib_root_path() / 'configs/assets/dataset/nsclc_filtered_ids.json')

dataset = Chain(
    NSCLC(root=NSCLC_DATA_PATH),
    Filter(lambda id: id in filtered_ids),
    CanonicalCTOrientation(),
    Zoom(new_spacing=voxel_spacing),
    ScaleHU(),
    Shape(),
    Apply(image=np.float16),
    Apply(image=np.float32),
)

load_y = dataset.mask
