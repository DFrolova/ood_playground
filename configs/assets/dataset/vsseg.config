from connectome import Chain, Filter, Apply, CacheToRam
from amid.vs_seg import VSSEG

from ood.dataset.utils import Shape, Zoom, ScaleMRI
from ood.dataset.vsseg import RenameFields
from ood.paths import VSSEG_DATA_PATH


max_cache_size = 1
dataset = Chain(
    VSSEG(root=VSSEG_DATA_PATH),
    Filter(lambda has_meningioma: not has_meningioma),
    Filter(lambda has_schwannoma: has_schwannoma),
    RenameFields(),
    Zoom(new_spacing=voxel_spacing),
    ScaleMRI(),
    Shape(),
    Apply(image=np.float16, mask=np.bool_),
    CacheToRam(size=max_cache_size),
    Apply(image=np.float32, mask=np.float32)
)

load_x = dataset.image
load_y = dataset.mask

n_tumors = np.ones(len(train_ids))
