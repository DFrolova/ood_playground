import numpy as np

from dpipe.dataset.wrappers import apply, cache_methods
from ood.dataset.cc359 import CC359
from ood.dataset.utils import Rescale3D, scale_mri
from ood.paths import CC359_DATA_PATH


data_path = CC359_DATA_PATH

# if `voxel_spacing[i]` is `None` when `i`-th dimension will be used without scaling
voxel_spacing = (1, 0.95, 0.95)
max_cache_size = 30

preprocessed_dataset = apply(Rescale3D(CC359(data_path), voxel_spacing), load_image=scale_mri)
# preprocessed_dataset = apply(Rescale3D(CC359(data_path, target='hippo_mask', 
#                                              metadata_rpath='meta_upd.csv'), voxel_spacing), load_image=scale_mri)
dataset = apply(cache_methods(apply(preprocessed_dataset, load_image=np.float16), maxsize=max_cache_size), load_image=np.float32)