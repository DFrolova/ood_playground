import numpy as np

from amid.lidc import LIDC
from connectome import Chain, Apply, CacheToRam

from ood.dataset.lidc import CanonicalCTOrientation, RenameFields
from ood.dataset.utils import Shape, Zoom, ScaleHU
from ood.paths import LIDC_DATA_PATH
from ood.dataset.augm_transforms import ApplyAllAugms


dataset_raw = Chain(
    LIDC(root=LIDC_DATA_PATH),
    RenameFields(),
    ApplyAllAugms(param_file='param_dict_lidc.json', transform_file='transform_dict_lidc.json'),
    CanonicalCTOrientation()
)

max_cache_size = 1
dataset = Chain(
    dataset_raw,
    Zoom(new_spacing=voxel_spacing),
    ScaleHU(),
    Shape(),
    # Apply(image=np.float16, mask=np.bool_),
    # CacheToRam(size=max_cache_size),
    Apply(image=np.float32, mask=np.float32)
)

load_y = dataset.mask
