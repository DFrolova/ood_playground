import numpy as np

from amid.vs_seg import VSSEG
from connectome import Chain, Apply, CacheToRam, Filter

from ood.dataset.vsseg import RenameFields, CanonicalMRIOrientation
from ood.dataset.utils import Shape, Zoom, ScaleMRI
from ood.paths import VSSEG_DATA_PATH
from ood.dataset.augm_transforms import ApplyAllAugms


dataset_raw = Chain(
    VSSEG(root=VSSEG_DATA_PATH),
    Filter(lambda has_meningioma: not has_meningioma),
    Filter(lambda has_schwannoma: has_schwannoma),
    RenameFields(),
    CanonicalMRIOrientation(),
    ApplyAllAugms(param_file='param_dict_vsseg.json', transform_file='transform_dict_vsseg.json'),
)

max_cache_size = 1
dataset = Chain(
    dataset_raw,
    Zoom(new_spacing=voxel_spacing),
    ScaleMRI(),
    Shape(),
    # Apply(image=np.float16, mask=np.bool_),
    # CacheToRam(size=max_cache_size),
    Apply(image=np.float32, mask=np.float32)
)

load_y = dataset.mask
