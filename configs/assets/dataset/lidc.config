from amid.lidc import LIDC
from amid.internals import CacheToDisk
from connectome import Chain, Apply, CacheToRam

from ood.dataset.lidc import CanonicalCTOrientation, NumberOfTumors
from ood.paths import LIDC_DATA_PATH


dataset_raw = LIDC(root=LIDC_DATA_PATH) >> NumberOfTumors() >> CacheToDisk('n_tumors') >> CanonicalCTOrientation()
max_cache_size = 810
final_layer = Apply(image=np.float16, mask=np.bool_) >> CacheToRam(size=max_cache_size) >> 
              Apply(image=np.float32, mask=np.float32)

n_tumors = list(map(dataset.n_tumors, train_ids))
